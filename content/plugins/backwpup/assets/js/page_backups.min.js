jQuery(document).ready(function(a){a(".backup-download-link").click(function(){a("#download-file-waiting").show(),a("#download-file-generating").hide(),a("#download-file-private-key").hide(),a("#download-file-done").hide();var b=this,c=new EventSource(ajaxurl+"?action=download_file&destination="+a(this).data("destination")+"&jobid="+a(this).data("jobid")+"&file="+a(this).data("file")+"&local_file="+a(this).data("localFile")+"&_wpnonce="+a(this).data("nonce"));c.onmessage=function(d){var e=JSON.parse(d.data);"downloading"===e.state?(a("#download-file-waiting").hide(),a("#download-file-generating").show(),a("#download-file-private-key").hide(),a("#download-file-done").hide(),a("#progresssteps").css({width:e.download_percent+"%"}).text(e.download_percent+"%")):"need-private-key"===e.state?(a("#download-file-waiting").hide(),a("#download-file-generating").hide(),a("#download-file-private-key").show(),a("#download-file-done").hide(),a("#download-file-private-key-input").focus(),"invalid"===e.status?a("#download-file-private-key-invalid").show():a("#download-file-private-key-invalid").hide()):"done"===e.state&&(a("#download-file-waiting").hide(),a("#download-file-generating").hide(),a("#download-file-private-key").hide(),a("#download-file-done").show(),c.close(),window.location.href=a(b).data("url"),setTimeout(function(){tb_remove()},3e3))}}),a("#download-file-private-key-button").click(function(){data={action:"send_private_key",privatekey:a("#download-file-private-key-input").val()},a.post(ajaxurl,data,function(b){"ok"===b&&(a("#download-file-private-key-input").val(""),a("#download-file-private-key-invalid").hide(),a("#download-file-private-key").hide(),a("#download-file-generating").show())})})});